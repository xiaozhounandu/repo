<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Dify 多文件解析演示</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 8px 16px; font-size: 16px; margin-bottom: 20px; }
        pre { background-color: #f9f9f9; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; }
        .section { margin-bottom: 30px; }
    </style>
</head>
<body>

<h1>Dify 多文件解析演示</h1>

<label>输入 OA 文件 ID（用逗号分隔）:</label>
<input type="text" id="fileIds" value="58435">
<button onclick="autoUploadMultiple()">开始自动下载并解析</button>

<div class="section">
    <h2>解析结果</h2>
    <pre id="result"></pre>
</div>

<div class="section">
    <h2>原始响应（调试用）</h2>
    <pre id="rawResponse"></pre>
</div>

<script>
    async function autoUploadMultiple() {
        const btn = document.querySelector("button");
        btn.disabled = true;
        btn.textContent = "处理中，请稍候...";

        const resultEl = document.getElementById("result");
        const rawEl = document.getElementById("rawResponse");
        resultEl.textContent = "";
        rawEl.textContent = "";

        try {
            // 读取文件 ID 列表
            const input = document.getElementById("fileIds").value.trim();
            const numbers = input.split(",").map(id => id.trim());

            // 调用后端接口
            const resp = await fetch(`http://localhost:8080/api/auto-upload?numbers=${numbers.join("&numbers=")}`);
            const data = await resp.json();

            if (data.error) {
                alert("错误: " + data.error);
                return;
            }

            // 显示 answer_text
            if (data.answer_text) {
                let text = data.answer_text.replace(/```json\s*([\s\S]*?)```/, "$1");
                resultEl.textContent += "解析文本:\n" + text + "\n\n";
            }

            // 显示 answer_json
            if (data.answer_json) {
                resultEl.textContent += "JSON内容:\n" + JSON.stringify(data.answer_json, null, 2) + "\n\n";
            }

            // 显示上传文件 ID
            if (data.upload_file_ids) {
                resultEl.textContent += "上传文件 IDs:\n" + data.upload_file_ids.join(", ") + "\n\n";
            }

            // 显示原始响应
            if (data.raw_response) {
                rawEl.textContent = data.raw_response;
            }

        } catch (err) {
            console.error(err);
            alert("操作失败: " + err.message);
        } finally {
            btn.disabled = false;
            btn.textContent = "开始自动下载并解析";
        }
    }
</script>

</body>
</html>
